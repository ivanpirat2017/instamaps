# Проект для портфолио: Фотосообщество с геопривязкой и визуальным поиском

## Описание проекта
Веб-приложение для обмена фотографиями с акцентом на визуальный поиск и геолокацию. Пользователи могут публиковать фото, искать их по описанию или местоположению на карте, комментировать посты и настраивать профили. Проект демонстрирует навыки работы с микросервисной архитектурой, современными фронтенд- и бэкенд-технологиями, контейнеризацией и локальной разработкой. Цель — создать функциональный прототип для портфолио, работающий локально с использованием популярных инструментов, востребованных в индустрии.

## Основные функции
1. **Лента фотографий**: Публикация и просмотр фото в хронологическом порядке.
2. **Визуальный поиск**: Поиск фото по текстовому описанию (например, "закат на пляже") с использованием ИИ (эмуляция через теги для локальной версии).
3. **Карты с геопривязкой**: Отображение местоположений фото на карте с использованием MapLibre GL и векторных тайлов.
4. **Комментарии**: Добавление и просмотр комментариев к постам.
5. **Профиль пользователя**:
   - Аватар, ник, биография, теги.
   - Сетка опубликованных фото с привязкой к карте.
6. **Аутентификация**:
   - Регистрация/вход по почте с кодом подтверждения.
   - Альтернативный вход через логин и пароль.
7. **Локальная работа**: Все сервисы запускаются в Docker-контейнерах, включая карты и тайловый сервер.

## Технологический стек
Проект использует современные технологии, популярные в 2025 году среди компаний, таких как стартапы и крупные IT-корпорации.

### Фронтенд
- **Vue.js 3**: Реактивный фреймворк для построения SPA (Single Page Application).
- **Vite**: Быстрый сборщик для разработки и продакшена.
- **Pinia**: Управление состоянием приложения.
- **Vue Router**: Навигация между страницами (лента, профиль, карта).
- **Tailwind CSS**: Утилитарный CSS-фреймворк для быстрого создания современного UI.
- **MapLibre GL JS**: Библиотека для интерактивных карт с поддержкой векторных тайлов.
- **Axios**: HTTP-клиент для взаимодействия с бэкендом.

### Бэкенд
- **Python 3.11+**: Основной язык для микросервисов.
- **FastAPI**: Асинхронный веб-фреймворк для создания REST API (высокая производительность и автодокументация через OpenAPI).
- **SQLAlchemy + Alembic**: ORM для работы с базой данных и миграций.
- **Pydantic**: Валидация данных и сериализация.
- **Celery + Redis**: Асинхронная очередь задач для отправки email (например, кодов подтверждения).
- **Pillow**: Обработка изображений (ресайз, оптимизация для загрузки фото).

### База данных
- **PostgreSQL**: Реляционная база для хранения пользователей, постов, комментариев.
- **PostGIS**: Расширение PostgreSQL для геопространственных запросов (хранение координат фото).

### Аутентификация
- **JWT (JSON Web Tokens)**: Токены для безопасной авторизации.
- **Passlib**: Хеширование паролей (bcrypt).
- **SMTP (локальная эмуляция)**: Отправка кодов подтверждения по почте через MailHog для тестирования.

### Карты и геолокация
- **MapLibre GL JS**: Открытая библиотека для рендеринга карт на фронтенде.
- **VectorTileGL**: Рендеринг векторных тайлов для плавной работы карт.
- **TileServer GL**: Локальный сервер для предоставления векторных тайлов (MBTiles или GeoJSON).
- **OpenStreetMap (OSM)**: Источник данных для карт (локально загруженные тайлы).

### Инфраструктура
- **Docker**: Контейнеризация всех сервисов (фронтенд, бэкенд, база данных, тайловый сервер, Redis, MailHog).
- **Docker Compose**: Оркестрация микросервисов для локального запуска.
- **Nginx**: Реверс-прокси для маршрутизации запросов между фронтендом и бэкендом.
- **Traefik** (опционально): Современный прокси для упрощения работы с микросервисами.

### Тестирование
- **Pytest**: Тестирование бэкенда (юнит- и интеграционные тесты).
- **Vitest**: Тестирование фронтенда.
- **Playwright**: E2E-тесты для проверки пользовательских сценариев.

### Логирование и мониторинг
- **Loki + Grafana**: Сбор и визуализация логов для отладки (локально).
- **Sentry** (эмуляция): Отслеживание ошибок в реальном времени.

## Архитектура
Проект использует микросервисную архитектуру для демонстрации навыков работы с распределёнными системами. Все сервисы запускаются локально через Docker Compose.

### Микросервисы
1. **Auth Service** (FastAPI):
   - Регистрация/вход по email (код подтверждения) или логин/пароль.
   - Выдача и валидация JWT.
   - Эмуляция отправки email через MailHog.
2. **Post Service** (FastAPI):
   - Создание, получение, удаление постов (фото, описание, геолокация).
   - Визуальный поиск (по тегам для локальной версии).
3. **Comment Service** (FastAPI):
   - Добавление и получение комментариев к постам.
4. **Map Service** (TileServer GL):
   - Предоставление векторных тайлов для MapLibre GL.
   - Хранение локальных данных OSM.
5. **Frontend Service** (Vue.js):
   - SPA с лентой, профилем, картой и визуальным поиском.

### Взаимодействие
- **API Gateway** (Nginx/Traefik): Маршрутизация запросов от фронтенда к микросервисам.
- **REST API**: Основной способ взаимодействия между сервисами.
- **Redis**: Хранение временных данных (например, кодов подтверждения) и очереди задач.
- **PostgreSQL + PostGIS**: Единая база для всех сервисов (для упрощения в локальной версии).

## Локальная настройка
1. **Требования**:
   - Docker и Docker Compose.
   - Node.js (для локальной разработки фронтенда, если нужно).
   - Python 3.11+ (для локальной отладки бэкенда).
2. **Запуск**:
   - Клонировать репозиторий.
   - Настроить `.env` с параметрами (SMTP, ключи JWT, подключение к PostgreSQL).
   - Выполнить `docker-compose up -d`.
   - Приложение доступно на `localhost:8080`.
3. **Тестовые данные**:
   - Скрипт для заполнения PostgreSQL тестовыми пользователями и постами.
   - Локальный файл MBTiles с данными OSM для карт.

## Реализация ключевых функций
### Аутентификация
- **Регистрация по email**:
  - Пользователь вводит email, получает 6-значный код через MailHog (локальный SMTP-сервер).
  - Код валидируется через Redis (срок жизни — 5 минут).
- **Логин/пароль**:
  - Проверка хеша пароля через Passlib.
  - Выдача JWT с сроком действия (например, 1 час).
- **JWT**:
  - Хранится в `HttpOnly`-куки для безопасности.
  - Проверка токена на каждом защищённом маршруте.

### Визуальный поиск
- Для локальной версии: Поиск по тегам, добавленным вручную к постам.
- Эмуляция ИИ: Статический список тегов (например, "пейзаж", "еда") для фильтрации.
- API-эндпоинт: `GET /search?query=sunset` возвращает посты с соответствующими тегами.

### Карты
- **MapLibre GL JS**:
  - Рендеринг карты в браузере.
  - Отображение маркеров для постов с координатами.
- **TileServer GL**:
  - Локальный сервер предоставляет векторные тайлы из MBTiles.
  - Поддержка стилей через JSON (аналог Mapbox Style).
- **PostGIS**:
  - Хранение геолокации постов (тип данных `geometry`).
  - Запросы вида `ST_DWithin` для поиска фото в радиусе.

### Загрузка фото
- FastAPI принимает файлы через `UploadFile`.
- Pillow оптимизирует изображения (ресайз до 1080p, сжатие).
- Хранение файлов в локальной папке (`/storage`), привязка к постам через PostgreSQL.
 